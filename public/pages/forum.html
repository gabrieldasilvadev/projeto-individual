<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script
      type="module"
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"
    ></script>
    <script
      nomodule
      src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"
    ></script>
    <script src="../js/user-logged/toggle-menu.js" defer></script>

    <link rel="stylesheet" href="../css/main.css" />
    <title>Forum</title>
  </head>
  <body>
    <header id="header">
      <div class="l-container">
        <div class="l-header">
          <h4 class="header__logo">
            GBR<span class="text-red">21Pilots</span>
          </h4>
          <nav class="l-header__nav">
            <ul class="l-header__nav-list">
              <li class="header__nav--item">
                <a href="#"><h6 class="underline-effect">About</h6></a>
              </li>
              <li class="header__nav--item">
                <a href="#"><h6 class="underline-effect">Store</h6></a>
              </li>
              <li class="header__nav--item">
                <a href="#"><h6 class="underline-effect">Contact</h6></a>
              </li>
              <li class="header__nav--item">
                <a href="#"><h6 class="underline-effect">Gallery</h6></a>
              </li>
              <li class="header__nav--item">
                <div class="l-menu">
                  <ion-icon
                    class="user-menu"
                    size="large"
                    name="person-sharp"
                  ></ion-icon>
                  <ul class="menu-nav">
                    <li>
                      <div>
                        <ion-icon size="large" name="dice"></ion-icon
                        ><a href="#">Items</a>
                      </div>
                    </li>
                    <li>
                      <div>
                        <ion-icon size="large" name="chatbubbles"></ion-icon
                        ><a href="#">Forum</a>
                      </div>
                    </li>
                    <li>
                      <div>
                        <ion-icon size="large" name="create"></ion-icon
                        ><a href="#">Edit profile</a>
                      </div>
                    </li>
                    <li>
                      <div>
                        <ion-icon size="large" name="close-sharp"></ion-icon
                        ><a href="#">Sair</a>
                      </div>
                    </li>
                  </ul>
                </div>
              </li>
            </ul>
          </nav>
        </div>
      </div>
    </header>

    <main class="l-container">
      <div class="l-forum-container">
        <div class="header-forum">Chat - Twenty one Pilots</div>
        <div class="l-forum-content">
          <div id="l-forum-chat">
            <div id="forum-message" class="message-row"></div>
          </div>
          <div class="forum-post-comment">
            <form class="forum-post-comment-form" id="chat">
              <input
                type="text"
                name="comment"
                placeholder="Escreva um comentÃ¡rio..."
                class="forum-post-comment-input"
                id="post-comment-input"
              />
              <input type="hidden" name="id_post" />
              <button type="submit" class="btn primary-btn" id="btn-enviar">
                Enviar
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>
    <script type="text/javascript" src="../js/forum/post.js"></script>
  </body>
</html>
<script type="text/javascript">
  function showMessage(text, isMine = false) {
    document.getElementById('l-forum-chat').innerHTML += `
      <div class="message-row ${isMine ? 'mine' : 'theirs'}">
        <div class="bubble">Mensagem: ${text}</div> <br/> <br/>
      </div>
    `;
  }
  const ws = new WebSocket('ws://localhost:8080');
  ws.addEventListener('message', (ev) => {
    ev.data.text().then(showMessage);
  });
  document.querySelector('form').onsubmit = (ev) => {
    ev.preventDefault();
    const input = document.querySelector('input');
    ws.send(input.value);
    showMessage(input.value, true);
    input.value = '';
  };
</script>
